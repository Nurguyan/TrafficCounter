# TrafficCounter
Приложение использует библиотеку Pcap4j для захвата трафика сети. По умолчанию каждые 5 минут выводит объем захваченного трафика за период. Так же каждые 20 минут обновляет пороговые значения трафика на значения из базы данных с наиболее актуальной датой.
Если объем трафика меньше или больше пороговых значений, то посылается сообщение на сервер Kafka в топик 'alerts'.

## Инструкция по запуску
1. Клонировать репозиторий
2. Добавить поддержку maven, groovy в проект

### База данных
1. Скачать и установить PostgreSQL
2. Запустить сервер PostgreSQL
3. Отредактировать сom.company.database.IDataBaseConstants, изменив имя пользователя и пароль от PostgreSQL на свой.
4. Загрузить дамп базы данных db_dump.bak
База данных traffic_limits включает одну таблицу limits_per_hour с атрибутами limit_name varchar(), limit_value int, effective_date timestampz.

Драйвер PGJDBC-NG (PostgreSQL) используется для выполнения запросов и отправления асинхронных уведомлений при изменении базы данных. При изменении базы данных срабатывает триггер, который посылает уведомление в канал 'test'. Приложение слушает канал и при получении уведомления обновляет параметры максимального и минимального порога трафика сети.
Дамп базы данных находится в папке DB_dump.

### Apache Kafka
Запустить сервер Kafka перед запуском, иначе сообщения не будут отправляться.

### Фильтрация трафика
В качестве аргумента приложения можно задать BPF фильтр: https://en.wikipedia.org/wiki/Berkeley_Packet_Filter
Например, для того чтобы считать только тот трафик, который отправляется/принимается с определенного IP-адреса, входной параметр нужно задать как:
"host [IP]".
Например, "host 127.0.0.1".

### Изменение периода расчета трафика и обновления пороговых значений
Конструктор класса TrafficCounter может принимать 4 аргумента: устройство сети, фильтр, длительность периода захвата трафика и обновления пороговых значений из БД. 
